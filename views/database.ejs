<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Database Viewer | HomeConnect</title>
   
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
   <link rel="stylesheet" href="/css/style.css">
   
   <style>
      .db-container {
         max-width: 1400px;
         margin: 40px auto;
         padding: 0 20px;
      }
      
      .db-header {
         text-align: center;
         margin-bottom: 40px;
         padding: 30px;
         background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
         border-radius: 16px;
         color: white;
         box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
      }
      
      .db-header h1 {
         margin: 0 0 10px 0;
         font-size: 36px;
         font-weight: 700;
      }
      
      .db-header p {
         margin: 0;
         font-size: 16px;
         opacity: 0.9;
      }
      
      .db-stats {
         display: grid;
         grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
         gap: 20px;
         margin-bottom: 40px;
      }
      
      .stat-card {
         background: white;
         padding: 25px;
         border-radius: 12px;
         box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
         text-align: center;
         transition: all 0.3s ease;
         border: 2px solid transparent;
      }
      
      .stat-card:hover {
         transform: translateY(-5px);
         box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
         border-color: #2c6bed;
      }
      
      .stat-card .icon {
         font-size: 36px;
         margin-bottom: 10px;
      }
      
      .stat-card.mongodb .icon { color: #47A248; }
      .stat-card.postgres .icon { color: #336791; }
      .stat-card.mariadb .icon { color: #003545; }
      .stat-card.redis .icon { color: #DC382D; }
      
      .stat-card h3 {
         margin: 10px 0 5px 0;
         font-size: 32px;
         font-weight: 700;
         color: #2c3e50;
      }
      
      .stat-card p {
         margin: 0;
         color: #7f8c8d;
         font-size: 14px;
         text-transform: uppercase;
         letter-spacing: 0.5px;
      }
      
      .stat-card .status {
         margin-top: 10px;
         padding: 5px 12px;
         border-radius: 20px;
         font-size: 12px;
         font-weight: 600;
         display: inline-block;
      }
      
      .stat-card .status.connected {
         background: #d4edda;
         color: #155724;
      }
      
      .stat-card .status.disconnected {
         background: #f8d7da;
         color: #721c24;
      }
      
      .db-section {
         background: white;
         border-radius: 12px;
         padding: 30px;
         margin-bottom: 30px;
         box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      }
      
      .db-section h2 {
         margin: 0 0 20px 0;
         font-size: 24px;
         color: #2c3e50;
         display: flex;
         align-items: center;
         gap: 10px;
         padding-bottom: 15px;
         border-bottom: 2px solid #e8ecef;
      }
      
      .db-section h2 i {
         font-size: 28px;
      }
      
      .mongodb-section h2 { color: #47A248; }
      .postgres-section h2 { color: #336791; }
      .mariadb-section h2 { color: #003545; }
      
      .table-wrapper {
         overflow-x: auto;
         margin-top: 20px;
      }
      
      .data-table {
         width: 100%;
         border-collapse: collapse;
         font-size: 14px;
      }
      
      .data-table thead {
         background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      }
      
      .data-table th {
         padding: 15px 12px;
         text-align: left;
         font-weight: 600;
         color: #2c3e50;
         text-transform: uppercase;
         font-size: 12px;
         letter-spacing: 0.5px;
         border-bottom: 2px solid #2c6bed;
      }
      
      .data-table td {
         padding: 12px;
         border-bottom: 1px solid #e8ecef;
         color: #555;
      }
      
      .data-table tbody tr {
         transition: all 0.2s ease;
      }
      
      .data-table tbody tr:hover {
         background-color: #f8f9fa;
      }
      
      .data-table tbody tr:last-child td {
         border-bottom: none;
      }
      
      .no-data {
         text-align: center;
         padding: 40px;
         color: #95a5a6;
      }
      
      .no-data i {
         font-size: 48px;
         margin-bottom: 15px;
         opacity: 0.5;
      }
      
      .error-message {
         background: #fff3cd;
         border: 1px solid #ffc107;
         color: #856404;
         padding: 15px 20px;
         border-radius: 8px;
         margin: 15px 0;
      }
      
      .refresh-btn {
         background: linear-gradient(135deg, #2c6bed, #1a5ad7);
         color: white;
         border: none;
         padding: 12px 24px;
         border-radius: 8px;
         cursor: pointer;
         font-size: 14px;
         font-weight: 600;
         transition: all 0.3s ease;
         display: inline-flex;
         align-items: center;
         gap: 8px;
         box-shadow: 0 4px 12px rgba(44, 107, 237, 0.25);
      }
      
      .refresh-btn:hover {
         background: linear-gradient(135deg, #1a5ad7, #0d47a1);
         transform: translateY(-2px);
         box-shadow: 0 6px 16px rgba(44, 107, 237, 0.35);
      }
      
      .actions {
         display: flex;
         justify-content: space-between;
         align-items: center;
         margin-bottom: 20px;
      }
      
      .badge {
         display: inline-block;
         padding: 4px 10px;
         border-radius: 12px;
         font-size: 11px;
         font-weight: 600;
         text-transform: uppercase;
      }
      
      .badge.primary { background: #e3f2fd; color: #1976d2; }
      .badge.success { background: #e8f5e9; color: #388e3c; }
      .badge.warning { background: #fff3e0; color: #f57c00; }
      
      @media (max-width: 768px) {
         .db-header h1 { font-size: 28px; }
         .db-stats { grid-template-columns: 1fr 1fr; }
         .data-table { font-size: 12px; }
         .data-table th, .data-table td { padding: 8px 6px; }
      }
   </style>
</head>
<body>

<%- include('partials/header') %>

<div class="db-container">
   <div class="db-header">
      <h1><i class="fas fa-database"></i> Database Viewer</h1>
      <p>Real-time view of all database collections and tables</p>
   </div>
   
   <div class="db-stats">
      <div class="stat-card mongodb">
         <div class="icon"><i class="fas fa-leaf"></i></div>
         <h3><%= stats.mongodb.total %></h3>
         <p>MongoDB Documents</p>
         <span class="status <%= stats.mongodb.connected ? 'connected' : 'disconnected' %>">
            <%= stats.mongodb.connected ? 'Connected' : 'Disconnected' %>
         </span>
      </div>
      
      <div class="stat-card postgres">
         <div class="icon"><i class="fas fa-elephant"></i></div>
         <h3><%= stats.postgres.total %></h3>
         <p>PostgreSQL Rows</p>
         <span class="status <%= stats.postgres.connected ? 'connected' : 'disconnected' %>">
            <%= stats.postgres.connected ? 'Connected' : 'Disconnected' %>
         </span>
      </div>
      
      <div class="stat-card mariadb">
         <div class="icon"><i class="fas fa-database"></i></div>
         <h3><%= stats.mariadb.total %></h3>
         <p>MariaDB Rows</p>
         <span class="status <%= stats.mariadb.connected ? 'connected' : 'disconnected' %>">
            <%= stats.mariadb.connected ? 'Connected' : 'Disconnected' %>
         </span>
      </div>
      
      <!-- <div class="stat-card redis">
         <div class="icon"><i class="fas fa-bolt"></i></div>
         <h3><%= stats.redis.total %></h3>
         <p>Redis Keys</p>
         <span class="status <%= stats.redis.connected ? 'connected' : 'disconnected' %>">
            <%= stats.redis.connected ? 'Connected' : 'Disconnected' %>
         </span>
      </div> -->
   </div>
   
   <!-- MongoDB Section -->
   <div class="db-section mongodb-section">
      <h2><i class="fas fa-leaf"></i> MongoDB Collections</h2>
      
      <% if (data.mongodb.error) { %>
         <div class="error-message">
            <i class="fas fa-exclamation-triangle"></i>
            <%= data.mongodb.error %>
         </div>
      <% } else { %>
         <!-- Properties Collection -->
         <div class="actions">
            <h3>Properties (<%= data.mongodb.properties.length %>)</h3>
            <button class="refresh-btn" onclick="location.reload()">
               <i class="fas fa-sync-alt"></i> Refresh
            </button>
         </div>
         
         <% if (data.mongodb.properties.length > 0) { %>
            <div class="table-wrapper">
               <table class="data-table">
                  <thead>
                     <tr>
                        <th>ID</th>
                        <th>Title</th>
                        <th>Location</th>
                        <th>Type</th>
                        <th>Price</th>
                        <th>BHK</th>
                        <th>Status</th>
                        <th>Created</th>
                     </tr>
                  </thead>
                  <tbody>
                     <% data.mongodb.properties.forEach(prop => { %>
                        <tr>
                           <td><code><%= prop._id.toString().slice(-8) %></code></td>
                           <td><strong><%= prop.name %></strong></td>
                           <td><i class="fas fa-map-marker-alt"></i> <%= prop.address %></td>
                           <td><span class="badge primary"><%= prop.type %></span></td>
                           <td><strong>â‚¹<%= prop.price?.toLocaleString() || 'N/A' %></strong></td>
                           <td><%= prop.bhk %> BHK</td>
                           <td><span class="badge <%= prop.status === 'ready to move' ? 'success' : 'warning' %>"><%= prop.status %></span></td>
                           <td><%= new Date(prop.createdAt).toLocaleDateString() %></td>
                        </tr>
                     <% }) %>
                  </tbody>
               </table>
            </div>
         <% } else { %>
            <div class="no-data">
               <i class="fas fa-inbox"></i>
               <p>No properties found in database</p>
            </div>
         <% } %>
         
         <!-- Users Collection -->
         <div class="actions" style="margin-top: 40px;">
            <h3>Users (<%= data.mongodb.users.length %>)</h3>
         </div>
         
         <% if (data.mongodb.users.length > 0) { %>
            <div class="table-wrapper">
               <table class="data-table">
                  <thead>
                     <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Role</th>
                        <th>Registered</th>
                     </tr>
                  </thead>
                  <tbody>
                     <% data.mongodb.users.forEach(user => { %>
                        <tr>
                           <td><code><%= user._id.toString().slice(-8) %></code></td>
                           <td><strong><%= user.name %></strong></td>
                           <td><i class="fas fa-envelope"></i> <%= user.email %></td>
                           <td><i class="fas fa-phone"></i> <%= user.number || 'N/A' %></td>
                           <td><span class="badge <%= user.role === 'admin' ? 'warning' : 'primary' %>"><%= user.role || 'user' %></span></td>
                           <td><%= new Date(user.createdAt || Date.now()).toLocaleDateString() %></td>
                        </tr>
                     <% }) %>
                  </tbody>
               </table>
            </div>
         <% } else { %>
            <div class="no-data">
               <i class="fas fa-users-slash"></i>
               <p>No users found in database</p>
            </div>
         <% } %>
      <% } %>
   </div>
   
   <!-- PostgreSQL Section -->
   <div class="db-section postgres-section">
      <h2><i class="fas fa-elephant"></i> PostgreSQL Tables</h2>
      
      <% if (data.postgres.error) { %>
         <div class="error-message">
            <i class="fas fa-exclamation-triangle"></i>
            <%= data.postgres.error %>
         </div>
      <% } else if (data.postgres.users.length > 0) { %>
         <div class="actions">
            <h3>Demo Users (<%= data.postgres.users.length %>)</h3>
         </div>
         
         <div class="table-wrapper">
            <table class="data-table">
               <thead>
                  <tr>
                     <th>ID</th>
                     <th>Name</th>
                     <th>Email</th>
                     <th>Created At</th>
                  </tr>
               </thead>
               <tbody>
                  <% data.postgres.users.forEach(user => { %>
                     <tr>
                        <td><code>#<%= user.id %></code></td>
                        <td><strong><%= user.name %></strong></td>
                        <td><i class="fas fa-envelope"></i> <%= user.email %></td>
                        <td><%= new Date(user.created_at).toLocaleString() %></td>
                     </tr>
                  <% }) %>
               </tbody>
            </table>
         </div>
      <% } else { %>
         <div class="no-data">
            <i class="fas fa-inbox"></i>
            <p>No data in PostgreSQL. Run the demo schema to populate.</p>
         </div>
      <% } %>
   </div>
   
   <!-- MariaDB Section -->
   <div class="db-section mariadb-section">
      <h2><i class="fas fa-database"></i> MariaDB Tables</h2>
      
      <% if (data.mariadb.error) { %>
         <div class="error-message">
            <i class="fas fa-exclamation-triangle"></i>
            <%= data.mariadb.error %>
         </div>
      <% } else if (data.mariadb.users.length > 0) { %>
         <div class="actions">
            <h3>Demo Users (<%= data.mariadb.users.length %>)</h3>
         </div>
         
         <div class="table-wrapper">
            <table class="data-table">
               <thead>
                  <tr>
                     <th>ID</th>
                     <th>Name</th>
                     <th>Email</th>
                     <th>Created At</th>
                  </tr>
               </thead>
               <tbody>
                  <% data.mariadb.users.forEach(user => { %>
                     <tr>
                        <td><code>#<%= user.id %></code></td>
                        <td><strong><%= user.name %></strong></td>
                        <td><i class="fas fa-envelope"></i> <%= user.email %></td>
                        <td><%= new Date(user.created_at).toLocaleString() %></td>
                     </tr>
                  <% }) %>
               </tbody>
            </table>
         </div>
      <% } else { %>
         <div class="no-data">
            <i class="fas fa-inbox"></i>
            <p>No data in MariaDB. Run the demo schema to populate.</p>
         </div>
      <% } %>
   </div>
</div>

<%- include('partials/footer') %>

<script src="/js/script.js"></script>

</body>
</html>
